<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#0a0a0f">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>OGUN V9 - Security Intelligence System</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-database-compat.js"></script>
    
    <style>
        :root {
            --bg-primary: #0a0a0f;
            --bg-secondary: #111118;
            --bg-tertiary: #1a1a24;
            --bg-elevated: #222230;
            --bg-hover: #2a2a3a;
            --border-default: #2a2a3a;
            --border-light: #3a3a4a;
            --text-primary: #ffffff;
            --text-secondary: #b0b0c0;
            --text-muted: #707080;
            --text-disabled: #505060;
            --accent-primary: #e94560;
            --accent-hover: #ff5a75;
            --accent-muted: #c73850;
            --success: #10b981;
            --success-bg: rgba(16, 185, 129, 0.15);
            --warning: #f59e0b;
            --warning-bg: rgba(245, 158, 11, 0.15);
            --danger: #ef4444;
            --danger-bg: rgba(239, 68, 68, 0.15);
            --critical: #ff0040;
            --critical-bg: rgba(255, 0, 64, 0.2);
            --font-sans: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            --font-mono: 'SF Mono', Monaco, 'Courier New', monospace;
            --radius-sm: 6px;
            --radius-md: 10px;
            --radius-lg: 14px;
            --radius-xl: 20px;
            --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.3);
            --shadow-lg: 0 8px 24px rgba(0, 0, 0, 0.4);
            --shadow-glow: 0 0 20px rgba(233, 69, 96, 0.3);
        }
        
        *, *::before, *::after {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        html, body {
            height: 100%;
            overflow: hidden;
        }
        
        body {
            font-family: var(--font-sans);
            font-size: 14px;
            line-height: 1.5;
            color: var(--text-primary);
            background: var(--bg-primary);
            -webkit-font-smoothing: antialiased;
        }
        
        button {
            font-family: inherit;
            cursor: pointer;
            border: none;
            outline: none;
        }
        
        input {
            font-family: inherit;
            outline: none;
        }
        
        .app {
            display: flex;
            flex-direction: column;
            height: 100vh;
            height: 100dvh;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            background: linear-gradient(180deg, var(--bg-secondary) 0%, var(--bg-primary) 100%);
            border-bottom: 1px solid var(--border-default);
            position: relative;
            z-index: 100;
        }
        
        .header-left {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .logo-icon {
            font-size: 26px;
            filter: drop-shadow(0 0 10px rgba(233, 69, 96, 0.5));
        }
        
        .logo-text {
            font-family: var(--font-mono);
            font-size: 20px;
            font-weight: 700;
            color: var(--accent-primary);
            letter-spacing: 3px;
            text-shadow: 0 0 20px rgba(233, 69, 96, 0.4);
        }
        
        .logo-version {
            font-family: var(--font-mono);
            font-size: 9px;
            font-weight: 600;
            color: var(--text-muted);
            background: var(--bg-tertiary);
            padding: 2px 6px;
            border-radius: 4px;
            margin-left: 4px;
        }
        
        .header-right {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .status-badge {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 14px;
            border-radius: 20px;
            font-family: var(--font-mono);
            font-size: 11px;
            font-weight: 600;
            letter-spacing: 1px;
            transition: all 0.3s ease;
        }
        
        .status-badge.standby {
            background: var(--bg-tertiary);
            color: var(--text-muted);
            border: 1px solid var(--border-default);
        }
        
        .status-badge.active {
            background: var(--success-bg);
            color: var(--success);
            border: 1px solid var(--success);
            box-shadow: 0 0 15px rgba(16, 185, 129, 0.3);
            animation: statusPulse 2s ease-in-out infinite;
        }
        
        .status-badge.error {
            background: var(--danger-bg);
            color: var(--danger);
            border: 1px solid var(--danger);
        }
        
        @keyframes statusPulse {
            0%, 100% { box-shadow: 0 0 15px rgba(16, 185, 129, 0.3); }
            50% { box-shadow: 0 0 25px rgba(16, 185, 129, 0.5); }
        }
        
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: currentColor;
        }
        
        .status-badge.active .status-dot {
            animation: dotPulse 1.5s ease-in-out infinite;
        }
        
        @keyframes dotPulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.3); opacity: 0.7; }
        }
        
        .btn-icon {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-default);
            border-radius: var(--radius-md);
            font-size: 18px;
            transition: all 0.2s ease;
        }
        
        .btn-icon:hover {
            background: var(--bg-hover);
            border-color: var(--border-light);
        }
        
        .btn-icon:active {
            transform: scale(0.95);
        }
        
        .debug-panel {
            display: none;
            background: #0d0a0a;
            border-bottom: 1px solid #3a1a1a;
            max-height: 150px;
            overflow-y: auto;
            font-family: var(--font-mono);
            font-size: 11px;
        }
        
        .debug-panel.visible {
            display: block;
        }
        
        .debug-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            background: #1a0d0d;
            border-bottom: 1px solid #2a1515;
            position: sticky;
            top: 0;
        }
        
        .debug-title {
            color: #ff6b6b;
            font-weight: 600;
        }
        
        .debug-clear {
            background: #2a1515;
            color: #ff6b6b;
            border: none;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 10px;
            cursor: pointer;
        }
        
        .debug-content {
            padding: 8px 12px;
        }
        
        .debug-entry {
            padding: 3px 0;
            border-bottom: 1px solid #1a1212;
            word-break: break-all;
        }
        
        .debug-entry:last-child {
            border-bottom: none;
        }
        
        .debug-entry.error {
            color: #ff6b6b;
        }
        
        .debug-entry.success {
            color: #4ade80;
        }
        
        .debug-entry.info {
            color: #60a5fa;
        }
        
        .debug-entry.warning {
            color: #fbbf24;
        }
        
        .debug-toggle {
            position: fixed;
            top: 58px;
            right: 12px;
            background: #2a1515;
            color: #ff6b6b;
            border: 1px solid #3a2020;
            padding: 6px 10px;
            border-radius: 6px;
            font-family: var(--font-mono);
            font-size: 10px;
            font-weight: 600;
            cursor: pointer;
            z-index: 150;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .debug-toggle:hover {
            background: #3a2020;
        }
        
        .main {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
        }
        
        .transcript {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            scroll-behavior: smooth;
        }
        
        .transcript::-webkit-scrollbar {
            width: 6px;
        }
        
        .transcript::-webkit-scrollbar-track {
            background: transparent;
        }
        
        .transcript::-webkit-scrollbar-thumb {
            background: var(--border-default);
            border-radius: 3px;
        }
        
        .transcript::-webkit-scrollbar-thumb:hover {
            background: var(--border-light);
        }
        
        .empty-state {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 40px 20px;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .empty-icon {
            font-size: 72px;
            margin-bottom: 20px;
            opacity: 0.4;
            filter: grayscale(30%);
        }
        
        .empty-title {
            font-family: var(--font-mono);
            font-size: 22px;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 10px;
            letter-spacing: 2px;
        }
        
        .empty-desc {
            font-size: 14px;
            color: var(--text-muted);
            max-width: 300px;
            line-height: 1.6;
        }
        
        .empty-hint {
            margin-top: 20px;
            padding: 12px 16px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-default);
            border-radius: var(--radius-md);
            font-size: 12px;
            color: var(--text-muted);
        }
        
        .empty-hint strong {
            color: var(--accent-primary);
        }
        
        .entry {
            background: var(--bg-secondary);
            border-radius: var(--radius-lg);
            padding: 14px 16px;
            border-left: 4px solid var(--border-default);
            animation: entrySlide 0.3s ease;
            transition: all 0.3s ease;
        }
        
        @keyframes entrySlide {
            from { 
                opacity: 0; 
                transform: translateX(-20px); 
            }
            to { 
                opacity: 1; 
                transform: translateX(0); 
            }
        }
        
        .entry:hover {
            background: var(--bg-tertiary);
        }
        
        .entry.threat-safe {
            border-left-color: var(--success);
        }
        
        .entry.threat-low {
            border-left-color: var(--success);
            background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--success-bg) 100%);
        }
        
        .entry.threat-medium {
            border-left-color: var(--warning);
            background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--warning-bg) 100%);
        }
        
        .entry.threat-high {
            border-left-color: var(--danger);
            background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--danger-bg) 100%);
            box-shadow: inset 0 0 30px rgba(239, 68, 68, 0.1);
        }
        
        .entry.threat-critical {
            border-left-color: var(--critical);
            background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--critical-bg) 100%);
            box-shadow: inset 0 0 40px rgba(255, 0, 64, 0.15);
            animation: entrySlide 0.3s ease, criticalPulse 2s ease-in-out infinite;
        }
        
        @keyframes criticalPulse {
            0%, 100% { box-shadow: inset 0 0 40px rgba(255, 0, 64, 0.15), 0 0 0 0 rgba(255, 0, 64, 0); }
            50% { box-shadow: inset 0 0 40px rgba(255, 0, 64, 0.15), 0 0 20px 5px rgba(255, 0, 64, 0.2); }
        }
        
        .entry-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }
        
        .entry-time {
            font-family: var(--font-mono);
            font-size: 10px;
            color: var(--text-muted);
        }
        
        .entry-lang {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 11px;
            color: var(--accent-primary);
            font-weight: 500;
        }
        
        .entry-lang-flag {
            font-size: 14px;
        }
        
        .entry-source {
            font-family: var(--font-mono);
            font-size: 9px;
            color: var(--text-disabled);
            background: var(--bg-tertiary);
            padding: 2px 8px;
            border-radius: 4px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .entry-badge {
            margin-left: auto;
            padding: 4px 10px;
            border-radius: 6px;
            font-family: var(--font-mono);
            font-size: 9px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .entry-badge.safe {
            background: var(--success);
            color: white;
        }
        
        .entry-badge.low {
            background: var(--success);
            color: white;
        }
        
        .entry-badge.medium {
            background: var(--warning);
            color: #1a1a1a;
        }
        
        .entry-badge.high {
            background: var(--danger);
            color: white;
        }
        
        .entry-badge.critical {
            background: var(--critical);
            color: white;
            animation: badgePulse 0.6s ease-in-out infinite;
        }
        
        @keyframes badgePulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.05); }
        }
        
        .entry-body {
            margin-bottom: 10px;
        }
        
        .entry-original {
            font-size: 12px;
            color: var(--text-muted);
            font-style: italic;
            margin-bottom: 8px;
            padding: 10px 12px;
            background: var(--bg-tertiary);
            border-radius: var(--radius-sm);
            border-left: 2px solid var(--border-light);
        }
        
        .entry-translation {
            font-size: 15px;
            color: var(--text-primary);
            line-height: 1.6;
        }
        
        .entry-footer {
            padding-top: 10px;
            border-top: 1px solid var(--border-default);
        }
        
        .entry-threat {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        
        .entry-threat-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .entry-threat-category {
            font-size: 12px;
            font-weight: 600;
            color: var(--accent-primary);
        }
        
        .entry-threat-confidence {
            font-family: var(--font-mono);
            font-size: 10px;
            color: var(--text-muted);
        }
        
        .entry-threat-pattern {
            font-family: var(--font-mono);
            font-size: 11px;
            color: var(--text-muted);
            background: var(--bg-tertiary);
            padding: 6px 10px;
            border-radius: var(--radius-sm);
            word-break: break-all;
        }
        
        .processing {
            display: none;
            align-items: center;
            justify-content: center;
            gap: 12px;
            padding: 14px 16px;
            background: var(--bg-secondary);
            border-top: 1px solid var(--border-default);
        }
        
        .processing.active {
            display: flex;
        }
        
        .processing-spinner {
            width: 18px;
            height: 18px;
            border: 2px solid var(--border-default);
            border-top-color: var(--accent-primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .processing-text {
            font-size: 13px;
            color: var(--text-secondary);
        }
        
        .processing-lang {
            font-size: 12px;
            color: var(--accent-primary);
            font-weight: 500;
        }
        
        .controls {
            padding: 16px;
            background: var(--bg-secondary);
            border-top: 1px solid var(--border-default);
        }
        
        .btn-activate {
            width: 100%;
            padding: 18px 24px;
            border-radius: var(--radius-lg);
            font-family: var(--font-mono);
            font-size: 15px;
            font-weight: 700;
            letter-spacing: 2px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            transition: all 0.3s ease;
            background: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-muted) 100%);
            color: white;
            box-shadow: var(--shadow-md), var(--shadow-glow);
        }
        
        .btn-activate:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg), 0 0 30px rgba(233, 69, 96, 0.4);
        }
        
        .btn-activate:active {
            transform: translateY(0);
        }
        
        .btn-activate.hidden {
            display: none;
        }
        
        .active-controls {
            display: none;
            gap: 12px;
        }
        
        .active-controls.visible {
            display: flex;
        }
        
        .btn-panic {
            background: linear-gradient(135deg, var(--danger) 0%, #dc2626 100%);
            color: white;
            border-radius: var(--radius-lg);
            padding: 16px 24px;
            font-family: var(--font-mono);
            font-size: 12px;
            font-weight: 700;
            letter-spacing: 1px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            box-shadow: var(--shadow-md);
            transition: all 0.2s ease;
        }
        
        .btn-panic:hover {
            transform: scale(1.02);
            box-shadow: 0 0 25px rgba(239, 68, 68, 0.4);
        }
        
        .btn-panic:active {
            transform: scale(0.98);
        }
        
        .btn-panic-icon {
            font-size: 24px;
        }
        
        .btn-deactivate {
            flex: 1;
            background: var(--bg-tertiary);
            color: var(--text-secondary);
            border: 1px solid var(--border-default);
            border-radius: var(--radius-lg);
            padding: 16px 24px;
            font-family: var(--font-mono);
            font-size: 14px;
            font-weight: 600;
            letter-spacing: 1px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.2s ease;
        }
        
        .btn-deactivate:hover {
            background: var(--bg-hover);
            border-color: var(--border-light);
        }
        
        .alert-overlay {
            display: none;
            position: fixed;
            inset: 0;
            z-index: 1000;
            flex-direction: column;
            background: var(--bg-primary);
            overflow-y: auto;
            animation: alertFadeIn 0.3s ease;
        }
        
        .alert-overlay.visible {
            display: flex;
        }
        
        @keyframes alertFadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .alert-header {
            padding: 24px 20px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .alert-header::before {
            content: '';
            position: absolute;
            inset: 0;
            background: inherit;
            filter: blur(50px);
            opacity: 0.5;
        }
        
        .alert-header.critical {
            background: linear-gradient(135deg, var(--critical) 0%, #cc0033 100%);
            animation: alertFlash 0.8s ease-in-out infinite;
        }
        
        .alert-header.high {
            background: linear-gradient(135deg, var(--danger) 0%, #b91c1c 100%);
        }
        
        .alert-header.medium {
            background: linear-gradient(135deg, var(--warning) 0%, #d97706 100%);
        }
        
        @keyframes alertFlash {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.85; }
        }
        
        .alert-header-content {
            position: relative;
            z-index: 1;
        }
        
        .alert-icon {
            font-size: 56px;
            margin-bottom: 12px;
            animation: alertIconPulse 1s ease-in-out infinite;
        }
        
        @keyframes alertIconPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        .alert-level {
            font-family: var(--font-mono);
            font-size: 26px;
            font-weight: 700;
            color: white;
            letter-spacing: 4px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            margin-bottom: 6px;
        }
        
        .alert-category {
            font-size: 16px;
            color: rgba(255, 255, 255, 0.9);
        }
        
        .alert-time {
            font-family: var(--font-mono);
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
            margin-top: 8px;
        }
        
        .alert-content {
            flex: 1;
            padding: 20px;
        }
        
        .alert-section {
            margin-bottom: 20px;
        }
        
        .alert-section-title {
            font-size: 11px;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1.5px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .alert-box {
            background: var(--bg-secondary);
            border: 1px solid var(--border-default);
            border-radius: var(--radius-lg);
            padding: 16px;
        }
        
        .alert-transcript {
            font-size: 15px;
            font-style: italic;
            line-height: 1.6;
            color: var(--text-primary);
            border-left: 3px solid var(--danger);
            padding-left: 14px;
        }
        
        .alert-location {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .alert-coords {
            font-family: var(--font-mono);
            font-size: 18px;
            font-weight: 600;
            color: var(--success);
        }
        
        .alert-address {
            font-size: 13px;
            color: var(--text-secondary);
            line-height: 1.5;
        }
        
        .alert-map {
            width: 100%;
            height: 200px;
            border-radius: var(--radius-md);
            border: 1px solid var(--border-default);
            margin-top: 12px;
        }
        
        .btn-directions {
            width: 100%;
            padding: 14px;
            margin-top: 12px;
            background: var(--success);
            color: white;
            border-radius: var(--radius-md);
            font-size: 14px;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.2s ease;
        }
        
        .btn-directions:hover {
            background: #0d9668;
        }
        
        .alert-details {
            display: flex;
            flex-direction: column;
        }
        
        .alert-detail-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid var(--border-default);
        }
        
        .alert-detail-row:last-child {
            border-bottom: none;
        }
        
        .alert-detail-label {
            font-size: 13px;
            color: var(--text-muted);
        }
        
        .alert-detail-value {
            font-size: 13px;
            color: var(--text-primary);
            font-weight: 500;
        }
        
        .alert-actions {
            display: flex;
            gap: 12px;
            padding: 20px;
            background: var(--bg-secondary);
            border-top: 1px solid var(--border-default);
        }
        
        .btn-alert-dismiss {
            flex: 1;
            padding: 16px;
            background: var(--bg-tertiary);
            color: var(--text-secondary);
            border: 1px solid var(--border-default);
            border-radius: var(--radius-lg);
            font-size: 14px;
            font-weight: 600;
            transition: all 0.2s ease;
        }
        
        .btn-alert-dismiss:hover {
            background: var(--bg-hover);
        }
        
        .btn-alert-escalate {
            flex: 1;
            padding: 16px;
            background: var(--danger);
            color: white;
            border-radius: var(--radius-lg);
            font-size: 14px;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.2s ease;
        }
        
        .btn-alert-escalate:hover {
            background: #dc2626;
        }
        
        .modal-overlay {
            display: none;
            position: fixed;
            inset: 0;
            z-index: 500;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(4px);
            align-items: center;
            justify-content: center;
            padding: 20px;
            animation: modalFadeIn 0.2s ease;
        }
        
        .modal-overlay.visible {
            display: flex;
        }
        
        @keyframes modalFadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .modal {
            width: 100%;
            max-width: 420px;
            max-height: 85vh;
            background: var(--bg-secondary);
            border: 1px solid var(--border-default);
            border-radius: var(--radius-xl);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            animation: modalSlideIn 0.3s ease;
        }
        
        @keyframes modalSlideIn {
            from { opacity: 0; transform: translateY(20px) scale(0.95); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 18px 20px;
            border-bottom: 1px solid var(--border-default);
        }
        
        .modal-title {
            font-size: 18px;
            font-weight: 600;
        }
        
        .modal-close {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--bg-tertiary);
            border-radius: var(--radius-sm);
            font-size: 18px;
            color: var(--text-muted);
            transition: all 0.2s ease;
        }
        
        .modal-close:hover {
            background: var(--bg-hover);
            color: var(--text-primary);
        }
        
        .modal-body {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }
        
        .settings-section {
            margin-bottom: 24px;
        }
        
        .settings-section:last-child {
            margin-bottom: 0;
        }
        
        .settings-section-title {
            font-size: 11px;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1.5px;
            margin-bottom: 12px;
        }
        
        .settings-group {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-default);
            border-radius: var(--radius-md);
            overflow: hidden;
        }
        
        .settings-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 14px 16px;
            border-bottom: 1px solid var(--border-default);
        }
        
        .settings-row:last-child {
            border-bottom: none;
        }
        
        .settings-label {
            font-size: 13px;
            color: var(--text-primary);
        }
        
        .settings-value {
            font-size: 12px;
            color: var(--text-muted);
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .settings-status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }
        
        .settings-status-dot.ok {
            background: var(--success);
            box-shadow: 0 0 8px rgba(16, 185, 129, 0.5);
        }
        
        .settings-status-dot.error {
            background: var(--danger);
            box-shadow: 0 0 8px rgba(239, 68, 68, 0.5);
        }
        
        .settings-status-dot.pending {
            background: var(--warning);
            box-shadow: 0 0 8px rgba(245, 158, 11, 0.5);
        }
        
        .settings-input-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
            padding: 14px 16px;
            border-bottom: 1px solid var(--border-default);
        }
        
        .settings-input-group:last-child {
            border-bottom: none;
        }
        
        .settings-input-label {
            font-size: 12px;
            color: var(--text-muted);
        }
        
        .settings-input {
            width: 100%;
            padding: 10px 12px;
            background: var(--bg-primary);
            border: 1px solid var(--border-default);
            border-radius: var(--radius-sm);
            font-family: var(--font-mono);
            font-size: 12px;
            color: var(--text-primary);
            transition: all 0.2s ease;
        }
        
        .settings-input:focus {
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(233, 69, 96, 0.1);
        }
        
        .settings-input::placeholder {
            color: var(--text-disabled);
        }
        
        .settings-btn-save {
            width: 100%;
            padding: 12px;
            margin-top: 12px;
            background: var(--accent-primary);
            color: white;
            border-radius: var(--radius-md);
            font-size: 13px;
            font-weight: 600;
            transition: all 0.2s ease;
        }
        
        .settings-btn-save:hover {
            background: var(--accent-hover);
        }
        
        .settings-languages {
            font-size: 12px;
            color: var(--text-secondary);
            line-height: 2;
            padding: 12px 16px;
        }
        
        .settings-duress {
            font-family: var(--font-mono);
            font-size: 13px;
            color: var(--accent-primary);
            padding: 12px 16px;
        }
        
        .toast {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--bg-elevated);
            color: var(--text-primary);
            padding: 14px 24px;
            border-radius: var(--radius-md);
            font-size: 13px;
            font-weight: 500;
            box-shadow: var(--shadow-lg);
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 1100;
            display: flex;
            align-items: center;
            gap: 10px;
            max-width: 90%;
        }
        
        .toast.visible {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }
        
        .toast.success {
            background: linear-gradient(135deg, #166534 0%, #15803d 100%);
            border: 1px solid var(--success);
        }
        
        .toast.error {
            background: linear-gradient(135deg, #991b1b 0%, #b91c1c 100%);
            border: 1px solid var(--danger);
        }
        
        .toast.warning {
            background: linear-gradient(135deg, #92400e 0%, #a16207 100%);
            border: 1px solid var(--warning);
        }
        
        .toast-icon {
            font-size: 18px;
        }
    </style>
</head>
<body>
    <div class="app" id="app">
        <header class="header">
            <div class="header-left">
                <div class="logo">
                    <span class="logo-icon">‚öîÔ∏è</span>
                    <span class="logo-text">OGUN</span>
                    <span class="logo-version">V9</span>
                </div>
            </div>
            <div class="header-right">
                <div class="status-badge standby" id="statusBadge">
                    <span class="status-dot"></span>
                    <span id="statusText">STANDBY</span>
                </div>
                <button class="btn-icon" id="btnSettings" aria-label="Settings">‚öôÔ∏è</button>
            </div>
        </header>
        
        <button class="debug-toggle" id="debugToggle">üêõ DEBUG</button>
        
        <div class="debug-panel" id="debugPanel">
            <div class="debug-header">
                <span class="debug-title">Debug Console</span>
                <button class="debug-clear" id="debugClear">Clear</button>
            </div>
            <div class="debug-content" id="debugContent"></div>
        </div>
        
        <main class="main">
            <div class="transcript" id="transcript">
                <div class="empty-state" id="emptyState">
                    <div class="empty-icon">‚öîÔ∏è</div>
                    <div class="empty-title">OGUN Ready</div>
                    <div class="empty-desc">
                        Real-time translation and threat detection for high-risk operations
                    </div>
                    <div class="empty-hint">
                        <strong>First time?</strong> Go to Settings to enter your API keys
                    </div>
                </div>
            </div>
            
            <div class="processing" id="processing">
                <div class="processing-spinner"></div>
                <span class="processing-text">Processing audio...</span>
                <span class="processing-lang" id="processingLang"></span>
            </div>
        </main>
        
        <div class="controls">
            <button class="btn-activate" id="btnActivate">
                <span>‚öîÔ∏è</span>
                <span>ACTIVATE OGUN</span>
            </button>
            <div class="active-controls" id="activeControls">
                <button class="btn-panic" id="btnPanic">
                    <span class="btn-panic-icon">üÜò</span>
                    <span>PANIC</span>
                </button>
                <button class="btn-deactivate" id="btnDeactivate">
                    <span>‚ñ†</span>
                    <span>DEACTIVATE</span>
                </button>
            </div>
        </div>
    </div>
    
    <div class="alert-overlay" id="alertOverlay">
        <div class="alert-header critical" id="alertHeader">
            <div class="alert-header-content">
                <div class="alert-icon">‚ö†Ô∏è</div>
                <div class="alert-level" id="alertLevel">CRITICAL THREAT</div>
                <div class="alert-category" id="alertCategory">Threat Category</div>
                <div class="alert-time" id="alertTime">--:--:--</div>
            </div>
        </div>
        
        <div class="alert-content">
            <div class="alert-section">
                <div class="alert-section-title">
                    <span>üìù</span> Intercepted Speech
                </div>
                <div class="alert-box">
                    <div class="alert-transcript" id="alertTranscript">‚Äî</div>
                </div>
            </div>
            
            <div class="alert-section">
                <div class="alert-section-title">
                    <span>üìç</span> Location
                </div>
                <div class="alert-box">
                    <div class="alert-location">
                        <div class="alert-coords" id="alertCoords">Acquiring GPS...</div>
                        <div class="alert-address" id="alertAddress">Resolving address...</div>
                        <iframe id="alertMap" class="alert-map" frameborder="0" allowfullscreen loading="lazy"></iframe>
                        <button class="btn-directions" id="btnDirections">
                            <span>üß≠</span>
                            <span>GET DIRECTIONS</span>
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="alert-section">
                <div class="alert-section-title">
                    <span>‚ÑπÔ∏è</span> Alert Details
                </div>
                <div class="alert-box alert-details">
                    <div class="alert-detail-row">
                        <span class="alert-detail-label">Confidence</span>
                        <span class="alert-detail-value" id="alertConfidence">‚Äî</span>
                    </div>
                    <div class="alert-detail-row">
                        <span class="alert-detail-label">Pattern Match</span>
                        <span class="alert-detail-value" id="alertPattern">‚Äî</span>
                    </div>
                    <div class="alert-detail-row">
                        <span class="alert-detail-label">Device</span>
                        <span class="alert-detail-value" id="alertDevice">OGUN-1</span>
                    </div>
                    <div class="alert-detail-row">
                        <span class="alert-detail-label">Admin Notified</span>
                        <span class="alert-detail-value" id="alertAdminEmail">‚Äî</span>
                    </div>
                    <div class="alert-detail-row">
                        <span class="alert-detail-label">Security Notified</span>
                        <span class="alert-detail-value" id="alertSecurityEmail">‚Äî</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="alert-actions">
            <button class="btn-alert-dismiss" id="btnAlertDismiss">DISMISS</button>
            <button class="btn-alert-escalate" id="btnAlertEscalate">
                <span>üìû</span>
                <span>CALL SECURITY</span>
            </button>
        </div>
    </div>
    
    <div class="modal-overlay" id="settingsModal">
        <div class="modal">
            <div class="modal-header">
                <span class="modal-title">Settings</span>
                <button class="modal-close" id="btnCloseSettings">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="settings-section">
                    <div class="settings-section-title">API Keys</div>
                    <div class="settings-group">
                        <div class="settings-input-group">
                            <label class="settings-input-label">Groq API Key (Speech Recognition)</label>
                            <input type="password" class="settings-input" id="inputGroqKey" placeholder="gsk_..." autocomplete="off">
                        </div>
                        <div class="settings-input-group">
                            <label class="settings-input-label">GhanaNLP API Key (Translation)</label>
                            <input type="password" class="settings-input" id="inputGhanaNlpKey" placeholder="Enter GhanaNLP key" autocomplete="off">
                        </div>
                        <button class="settings-btn-save" id="btnSaveKeys">Save API Keys</button>
                    </div>
                </div>
                
                <div class="settings-section">
                    <div class="settings-section-title">Connection Status</div>
                    <div class="settings-group">
                        <div class="settings-row">
                            <span class="settings-label">Groq (ASR)</span>
                            <span class="settings-value">
                                <span class="settings-status-dot pending" id="statusGroq"></span>
                                <span id="statusGroqText">Not configured</span>
                            </span>
                        </div>
                        <div class="settings-row">
                            <span class="settings-label">GhanaNLP (Translation)</span>
                            <span class="settings-value">
                                <span class="settings-status-dot pending" id="statusGhanaNlp"></span>
                                <span id="statusGhanaNlpText">Not configured</span>
                            </span>
                        </div>
                        <div class="settings-row">
                            <span class="settings-label">Firebase (Sync)</span>
                            <span class="settings-value">
                                <span class="settings-status-dot" id="statusFirebase"></span>
                                <span id="statusFirebaseText">Checking...</span>
                            </span>
                        </div>
                    </div>
                </div>
                
                <div class="settings-section">
                    <div class="settings-section-title">Team Contacts</div>
                    <div class="settings-group">
                        <div class="settings-input-group">
                            <label class="settings-input-label">Admin Email</label>
                            <input type="email" class="settings-input" id="inputAdminEmail" placeholder="admin@example.com">
                        </div>
                        <div class="settings-input-group">
                            <label class="settings-input-label">Security Email</label>
                            <input type="email" class="settings-input" id="inputSecurityEmail" placeholder="security@example.com">
                        </div>
                        <div class="settings-input-group">
                            <label class="settings-input-label">Security Phone</label>
                            <input type="tel" class="settings-input" id="inputSecurityPhone" placeholder="+233...">
                        </div>
                        <div class="settings-input-group">
                            <label class="settings-input-label">Device Name</label>
                            <input type="text" class="settings-input" id="inputDeviceName" placeholder="OGUN-1">
                        </div>
                        <button class="settings-btn-save" id="btnSaveTeam">Save Team Settings</button>
                    </div>
                </div>
                
                <div class="settings-section">
                    <div class="settings-section-title">Duress Code</div>
                    <div class="settings-group">
                        <div class="settings-duress">"Call my mom" ‚Äî triggers silent CRITICAL alert</div>
                    </div>
                </div>
                
                <div class="settings-section">
                    <div class="settings-section-title">Supported Languages</div>
                    <div class="settings-group">
                        <div class="settings-languages">
                            üá¨üá≠ Twi ‚Ä¢ Ga ‚Ä¢ Ewe ‚Ä¢ Dagbani ‚Ä¢ Fante<br>
                            üá≥üá¨ Hausa ‚Ä¢ Yoruba ‚Ä¢ Pidgin<br>
                            üåç English
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="toast" id="toast">
        <span class="toast-icon" id="toastIcon">‚ÑπÔ∏è</span>
        <span id="toastMessage">Message</span>
    </div>
    
    <script>
    (function() {
        'use strict';
        
        const CONFIG = {
            GROQ_URL: 'https://api.groq.com/openai/v1/audio/transcriptions',
            GROQ_MODEL: 'whisper-large-v3',
            GHANANLP_TRANSLATE_URL: 'https://translation-api.ghananlp.org/v1/translate',
            FIREBASE: {
                apiKey: "AIzaSyAiI07Y2Erzo7TIOoyOiXpiZIk7HoUyn8c",
                authDomain: "ogun-guardian-v1.firebaseapp.com",
                projectId: "ogun-guardian-v1",
                storageBucket: "ogun-guardian-v1.firebasestorage.app",
                messagingSenderId: "875607675728",
                appId: "1:875607675728:web:e52603a7ae927a58ead255",
                databaseURL: "https://ogun-guardian-v1-default-rtdb.europe-west1.firebasedatabase.app"
            },
            AUDIO_CHUNK_DURATION: 4000,
            AUDIO_MIN_SIZE: 1000,
            DURESS_CODES: ['call my mom', 'call my mum', 'call my mother', 'phone my mom', 'phone my mum', 'ring my mom', 'ring my mum'],
            LANGUAGES: {
                'tw': { name: 'Twi', flag: 'üá¨üá≠' },
                'ak': { name: 'Akan', flag: 'üá¨üá≠' },
                'ee': { name: 'Ewe', flag: 'üá¨üá≠' },
                'gaa': { name: 'Ga', flag: 'üá¨üá≠' },
                'dag': { name: 'Dagbani', flag: 'üá¨üá≠' },
                'fat': { name: 'Fante', flag: 'üá¨üá≠' },
                'ha': { name: 'Hausa', flag: 'üá≥üá¨' },
                'yo': { name: 'Yoruba', flag: 'üá≥üá¨' },
                'pcm': { name: 'Pidgin', flag: 'üá≥üá¨' },
                'en': { name: 'English', flag: 'üá¨üáß' }
            },
            STORAGE_KEYS: {
                GROQ_KEY: 'ogun_groq_key',
                GHANANLP_KEY: 'ogun_ghananlp_key',
                ADMIN_EMAIL: 'ogun_admin_email',
                SECURITY_EMAIL: 'ogun_security_email',
                SECURITY_PHONE: 'ogun_security_phone',
                DEVICE_NAME: 'ogun_device_name'
            }
        };
        
        const THREAT_PATTERNS = {
            critical: [
                { pattern: /\b(kill|murder|execute|eliminate|finish off)\s+(them|him|her|those|the\s+\w+)/i, category: 'DIRECT VIOLENCE THREAT', weight: 100 },
                { pattern: /\b(shoot|stab|slash|cut|hurt|beat|attack)\s+(them|him|her|those|the)/i, category: 'PHYSICAL ASSAULT THREAT', weight: 95 },
                { pattern: /\blet['']?s\s+(kill|attack|get|finish)\s+(them|him|her)/i, category: 'COORDINATED ATTACK', weight: 98 },
                { pattern: /\b(gun|knife|cutlass|machete|weapon|pistol|rifle)\b/i, category: 'WEAPON MENTION', weight: 90 },
                { pattern: /\bambush\b|\bintercept\s+them\b|\btrap\s+them\b/i, category: 'AMBUSH PLANNING', weight: 95 },
                { pattern: /\b(attack|strike|move|do\s+it)\s+(now|tonight|today|immediately)/i, category: 'IMMINENT ACTION', weight: 92 },
                { pattern: /\bno\s+(witness|witnesses)\b/i, category: 'WITNESS ELIMINATION', weight: 98 },
                { pattern: /\bmake\s+(them|him|her)\s+disappear/i, category: 'DISAPPEARANCE THREAT', weight: 97 }
            ],
            high: [
                { pattern: /\b(follow|track|watch|monitor|tail)\s+(them|him|her|those|the)/i, category: 'SURVEILLANCE', weight: 80 },
                { pattern: /\bwhere\s+(do\s+)?(they|he|she)\s+(stay|sleep|live|go|work)/i, category: 'LOCATION PROBING', weight: 78 },
                { pattern: /\bwhen\s+(do\s+)?(they|he|she)\s+(leave|arrive|come|go|move)/i, category: 'SCHEDULE PROBING', weight: 76 },
                { pattern: /\bwhat\s+time\b.{0,20}\b(leave|go|come|arrive|move)/i, category: 'TIMING INTELLIGENCE', weight: 75 },
                { pattern: /\bkeep\s+(an\s+)?eye\s+on/i, category: 'ACTIVE MONITORING', weight: 72 },
                { pattern: /\b(take|steal|grab|seize|collect)\s+(the\s+)?(gold|equipment|machine|vehicle|money|cash)/i, category: 'THEFT PLANNING', weight: 82 },
                { pattern: /\brob\b|\brobbery\b|\bsteal\s+from/i, category: 'ROBBERY INTENT', weight: 85 },
                { pattern: /\bbreak\s+in(to)?/i, category: 'BREAK-IN PLANNING', weight: 78 },
                { pattern: /\bcall\s+(the\s+)?(boys|guys|men|crew|team|others)/i, category: 'CALLING REINFORCEMENTS', weight: 75 },
                { pattern: /\bbring\s+(more\s+)?(people|boys|men|guys|backup|help)/i, category: 'REQUESTING BACKUP', weight: 77 },
                { pattern: /\bget\s+(the\s+)?(boys|guys|others)\s+(ready|prepared)/i, category: 'MOBILIZATION', weight: 76 },
                { pattern: /\btonight\b|\bafter\s+dark\b|\bat\s+night\b|\bmidnight\b/i, category: 'NIGHT OPERATION', weight: 70 },
                { pattern: /\bwhen\s+(it['']?s\s+)?dark/i, category: 'DARKNESS TIMING', weight: 68 },
                { pattern: /\b(the\s+)?(foreigners?|strangers?|outsiders?|visitors?)/i, category: 'FOREIGNER TARGETING', weight: 73 },
                { pattern: /\b(those|the)\s+people\s+(from|with|who)/i, category: 'GROUP TARGETING', weight: 70 },
                { pattern: /\bthe\s+(cleanup|remediation|mining|gold)\s+(people|team|crew|workers)/i, category: 'OPERATION TARGETING', weight: 78 },
                { pattern: /\bwhite\s+(people|man|men|woman|women)\b/i, category: 'RACIAL TARGETING', weight: 75 },
                { pattern: /\bthe\s+ones?\s+(with|from|working)/i, category: 'IDENTIFICATION', weight: 65 },
                { pattern: /\bblack\s+foreigners?\b/i, category: 'RACIAL TARGETING', weight: 75 }
            ],
            medium: [
                { pattern: /\bhow\s+many\s+(of\s+)?(them|people|guards|security)/i, category: 'NUMBER PROBING', weight: 55 },
                { pattern: /\bwho\s+(is\s+)?(guarding|watching|protecting|in\s+charge)/i, category: 'SECURITY PROBING', weight: 58 },
                { pattern: /\b(where|what)\s+(is\s+)?(the|their)\s+(camp|base|site|office|location)/i, category: 'LOCATION INTELLIGENCE', weight: 56 },
                { pattern: /\bwhat\s+(do\s+)?(they|he|she)\s+(have|carry|bring)/i, category: 'ASSET PROBING', weight: 52 },
                { pattern: /\bare\s+they\s+(armed|protected|guarded)/i, category: 'SECURITY ASSESSMENT', weight: 60 },
                { pattern: /\bgold\b|\bequipment\b|\bmachine(ry)?\b|\bvehicle\b|\btruck\b|\bcar\b/i, category: 'ASSET INTEREST', weight: 45 },
                { pattern: /\bgalamsey\b/i, category: 'GALAMSEY MENTION', weight: 40 },
                { pattern: /\bmoney\b|\bcash\b|\bpayment\b|\bvaluables?\b/i, category: 'FINANCIAL INTEREST', weight: 48 },
                { pattern: /\bexpensive\b|\bworth\s+(a\s+lot|much|plenty)/i, category: 'VALUE ASSESSMENT', weight: 45 },
                { pattern: /\bdon['']?t\s+tell\s+(them|anyone|him|her|nobody)/i, category: 'SECRECY INSTRUCTION', weight: 55 },
                { pattern: /\bkeep\s+(it\s+)?(quiet|secret|between\s+us)/i, category: 'CONFIDENTIALITY', weight: 52 },
                { pattern: /\bsecret(ly)?\b|\bhide\b|\bhidden\b|\bquietly\b/i, category: 'CONCEALMENT', weight: 50 },
                { pattern: /\bthey\s+(don['']?t|won['']?t|cannot|can['']?t)\s+know/i, category: 'INFORMATION DENIAL', weight: 55 },
                { pattern: /\bpretend\b|\bact\s+(like|normal)/i, category: 'DECEPTION', weight: 48 },
                { pattern: /\b(he|she)\s+told\s+(them|me|us)\b/i, category: 'INFORMATION LEAK', weight: 58 },
                { pattern: /\bthey\s+trust\s+(us|him|me|her)/i, category: 'TRUST EXPLOITATION', weight: 55 },
                { pattern: /\bwait\s+(till|until|for)\b/i, category: 'TIMING COORDINATION', weight: 45 },
                { pattern: /\binside(r)?\s+(man|person|help)/i, category: 'INSIDER REFERENCE', weight: 62 },
                { pattern: /\b(he|she)\s+(works?|is)\s+(with|for)\s+(them|us)/i, category: 'AFFILIATION', weight: 50 },
                { pattern: /\beasy\s+(target|job|money)/i, category: 'VULNERABILITY ASSESSMENT', weight: 55 },
                { pattern: /\bno\s+(security|guards?|protection)/i, category: 'SECURITY GAP', weight: 58 },
                { pattern: /\balone\b|\bby\s+(himself|herself|themselves)/i, category: 'ISOLATION NOTED', weight: 52 },
                { pattern: /\bweak\b|\bvulnerable\b|\bunprotected/i, category: 'WEAKNESS IDENTIFIED', weight: 55 }
            ],
            low: [
                { pattern: /\bstranger\b|\bnew\s+(person|people|face)/i, category: 'STRANGER AWARENESS', weight: 25 },
                { pattern: /\bsuspicious\b|\bstrange\b|\bunusual\b|\bodd\b/i, category: 'SUSPICION', weight: 28 },
                { pattern: /\bcareful\b|\bwatch\s+out\b|\bbe\s+alert\b|\bbeware\b/i, category: 'CAUTION EXPRESSED', weight: 22 },
                { pattern: /\bsomething['']?s?\s+(wrong|not\s+right|off|up)/i, category: 'UNEASE', weight: 25 },
                { pattern: /\bwho\s+(are|is)\s+(that|those|they)/i, category: 'INQUIRY', weight: 20 },
                { pattern: /\bnever\s+seen\s+(them|him|her)\s+before/i, category: 'UNFAMILIARITY', weight: 22 }
            ]
        };
        
        const state = {
            active: false,
            processing: false,
            mediaRecorder: null,
            audioChunks: [],
            location: null,
            address: '',
            debugMode: false,
            settings: {
                groqKey: '',
                ghanaNlpKey: '',
                adminEmail: 'infn.ogun@gmail.com',
                securityEmail: 'ogunsecure@gmail.com',
                securityPhone: '',
                deviceName: 'OGUN-1'
            }
        };
        
        let db = null;
        
        const DOM = {};
        
        function initDOM() {
            const ids = [
                'app', 'statusBadge', 'statusText', 'btnSettings', 'debugToggle', 'debugPanel',
                'debugContent', 'debugClear', 'transcript', 'emptyState', 'processing', 'processingLang',
                'btnActivate', 'activeControls', 'btnPanic', 'btnDeactivate', 'alertOverlay', 'alertHeader',
                'alertLevel', 'alertCategory', 'alertTime', 'alertTranscript', 'alertCoords', 'alertAddress',
                'alertMap', 'btnDirections', 'alertConfidence', 'alertPattern', 'alertDevice', 'alertAdminEmail',
                'alertSecurityEmail', 'btnAlertDismiss', 'btnAlertEscalate', 'settingsModal', 'btnCloseSettings',
                'inputGroqKey', 'inputGhanaNlpKey', 'btnSaveKeys', 'statusGroq', 'statusGroqText', 'statusGhanaNlp',
                'statusGhanaNlpText', 'statusFirebase', 'statusFirebaseText', 'inputAdminEmail', 'inputSecurityEmail',
                'inputSecurityPhone', 'inputDeviceName', 'btnSaveTeam', 'toast', 'toastIcon', 'toastMessage'
            ];
            ids.forEach(id => { DOM[id] = document.getElementById(id); });
        }
        
        function debugLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const consoleMethod = type === 'error' ? 'error' : type === 'warning' ? 'warn' : 'log';
            console[consoleMethod]('[OGUN ' + type.toUpperCase() + '] ' + message);
            
            if (DOM.debugContent) {
                const entry = document.createElement('div');
                entry.className = 'debug-entry ' + type;
                entry.textContent = '[' + timestamp + '] ' + message;
                DOM.debugContent.appendChild(entry);
                DOM.debugContent.scrollTop = DOM.debugContent.scrollHeight;
                while (DOM.debugContent.children.length > 100) {
                    DOM.debugContent.removeChild(DOM.debugContent.firstChild);
                }
            }
        }
        
        function showToast(message, type = 'info') {
            const icons = { success: '‚úì', error: '‚úï', warning: '‚ö†', info: '‚Ñπ' };
            DOM.toastIcon.textContent = icons[type] || icons.info;
            DOM.toastMessage.textContent = message;
            DOM.toast.className = 'toast visible ' + type;
            setTimeout(() => { DOM.toast.classList.remove('visible'); }, 3500);
        }
        
        function saveToStorage(key, value) {
            try { localStorage.setItem(key, value); return true; }
            catch (e) { debugLog('Storage save error: ' + e.message, 'error'); return false; }
        }
        
        function loadFromStorage(key, defaultValue = '') {
            try { return localStorage.getItem(key) || defaultValue; }
            catch (e) { debugLog('Storage load error: ' + e.message, 'error'); return defaultValue; }
        }
        
        function loadSettings() {
            state.settings.groqKey = loadFromStorage(CONFIG.STORAGE_KEYS.GROQ_KEY, '');
            state.settings.ghanaNlpKey = loadFromStorage(CONFIG.STORAGE_KEYS.GHANANLP_KEY, '');
            state.settings.adminEmail = loadFromStorage(CONFIG.STORAGE_KEYS.ADMIN_EMAIL, 'infn.ogun@gmail.com');
            state.settings.securityEmail = loadFromStorage(CONFIG.STORAGE_KEYS.SECURITY_EMAIL, 'ogunsecure@gmail.com');
            state.settings.securityPhone = loadFromStorage(CONFIG.STORAGE_KEYS.SECURITY_PHONE, '');
            state.settings.deviceName = loadFromStorage(CONFIG.STORAGE_KEYS.DEVICE_NAME, 'OGUN-1');
            
            DOM.inputGroqKey.value = state.settings.groqKey;
            DOM.inputGhanaNlpKey.value = state.settings.ghanaNlpKey;
            DOM.inputAdminEmail.value = state.settings.adminEmail;
            DOM.inputSecurityEmail.value = state.settings.securityEmail;
            DOM.inputSecurityPhone.value = state.settings.securityPhone;
            DOM.inputDeviceName.value = state.settings.deviceName;
            
            updateStatusIndicators();
            debugLog('Settings loaded', 'success');
        }
        
        function updateStatusIndicators() {
            if (state.settings.groqKey) {
                DOM.statusGroq.className = 'settings-status-dot ok';
                DOM.statusGroqText.textContent = 'Configured';
            } else {
                DOM.statusGroq.className = 'settings-status-dot pending';
                DOM.statusGroqText.textContent = 'Not configured';
            }
            
            if (state.settings.ghanaNlpKey) {
                DOM.statusGhanaNlp.className = 'settings-status-dot ok';
                DOM.statusGhanaNlpText.textContent = 'Configured';
            } else {
                DOM.statusGhanaNlp.className = 'settings-status-dot pending';
                DOM.statusGhanaNlpText.textContent = 'Not configured';
            }
            
            if (db) {
                DOM.statusFirebase.className = 'settings-status-dot ok';
                DOM.statusFirebaseText.textContent = 'Connected';
            } else {
                DOM.statusFirebase.className = 'settings-status-dot error';
                DOM.statusFirebaseText.textContent = 'Disconnected';
            }
        }
        
        function initFirebase() {
            if (typeof firebase === 'undefined') {
                debugLog('Firebase SDK loading, retrying...', 'warning');
                setTimeout(initFirebase, 500);
                return;
            }
            try {
                if (!firebase.apps.length) {
                    firebase.initializeApp(CONFIG.FIREBASE);
                }
                db = firebase.database();
                debugLog('Firebase initialized', 'success');
                updateStatusIndicators();
            } catch (e) {
                debugLog('Firebase error: ' + e.message, 'error');
            }
        }
                    if (state.active && state.mediaRecorder && state.mediaRecorder.state === 'inactive') {
                        state.audioChunks = [];
                        try {
                            state.mediaRecorder.start();
                            setTimeout(() => {
                                if (state.mediaRecorder && state.mediaRecorder.state === 'recording') {
                                    state.mediaRecorder.stop();
                                }
                            }, CONFIG.AUDIO_CHUNK_DURATION);
                        } catch (e) { debugLog('Recording restart error: ' + e.message, 'error'); }
                    }
                };
                
                state.mediaRecorder.onerror = (event) => { debugLog('MediaRecorder error: ' + event.error, 'error'); };
                
                state.mediaRecorder.start();
                debugLog('Audio capture started (4s cycles)', 'success');
                
                setTimeout(() => {
                    if (state.mediaRecorder && state.mediaRecorder.state === 'recording') {
                        state.mediaRecorder.stop();
                    }
                }, CONFIG.AUDIO_CHUNK_DURATION);
                
            } catch (e) {
                debugLog('Microphone error: ' + e.message, 'error');
                showToast('Microphone access denied', 'error');
                deactivate();
            }
        }
        
        function stopAudioCapture() {
            if (state.mediaRecorder) {
                try {
                    if (state.mediaRecorder.state === 'recording') { state.mediaRecorder.stop(); }
                    state.mediaRecorder.stream.getTracks().forEach(track => track.stop());
                } catch (e) { debugLog('Stop audio error: ' + e.message, 'error'); }
                state.mediaRecorder = null;
            }
            state.audioChunks = [];
            debugLog('Audio capture stopped');
        }
        
        async function processAudio(audioBlob) {
            if (state.processing) { debugLog('Already processing, skipping'); return; }
            
            state.processing = true;
            DOM.processing.classList.add('active');
            DOM.processingLang.textContent = '';
            
            try {
                debugLog('Sending to Groq for transcription...');
                const transcription = await transcribeWithGroq(audioBlob);
                
                if (!transcription || !transcription.text || transcription.text.trim().length < 2) {
                    debugLog('No speech detected in audio');
                    return;
                }
                
                const originalText = transcription.text.trim();
                const detectedLang = transcription.language || 'en';
                let translatedText = originalText;
                
                debugLog('Transcribed (' + detectedLang + '): "' + originalText.substring(0, 60) + (originalText.length > 60 ? '...' : '') + '"', 'success');
                DOM.processingLang.textContent = CONFIG.LANGUAGES[detectedLang]?.name || detectedLang;
                
                if (detectedLang !== 'en' && state.settings.ghanaNlpKey) {
                    debugLog('Translating from ' + (CONFIG.LANGUAGES[detectedLang]?.name || detectedLang) + '...');
                    const translated = await translateWithGhanaNLP(originalText, detectedLang);
                    if (translated) {
                        translatedText = translated;
                        debugLog('Translated: "' + translatedText.substring(0, 60) + (translatedText.length > 60 ? '...' : '') + '"', 'success');
                    } else {
                        debugLog('Translation failed, using original text', 'warning');
                    }
                }
                
                const threat = analyzeThreat(translatedText, originalText);
                addTranscriptEntry(originalText, translatedText, detectedLang, threat);
                
                if (threat) {
                    if (threat.level === 'critical' || threat.level === 'high') {
                        triggerAlert(threat, translatedText, originalText);
                    } else if (threat.level === 'medium') {
                        playAlertSound('medium');
                    }
                }
                
                syncToFirebase(originalText, translatedText, detectedLang, threat);
                
            } catch (e) {
                debugLog('Processing pipeline error: ' + e.message, 'error');
            } finally {
                state.processing = false;
                DOM.processing.classList.remove('active');
            }
        }
        
        async function transcribeWithGroq(audioBlob) {
            try {
                const formData = new FormData();
                formData.append('file', audioBlob, 'audio.webm');
                formData.append('model', CONFIG.GROQ_MODEL);
                formData.append('response_format', 'verbose_json');
                
                const response = await fetch(CONFIG.GROQ_URL, {
                    method: 'POST',
                    headers: { 'Authorization': 'Bearer ' + state.settings.groqKey },
                    body: formData
                });
                
                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error('Groq API ' + response.status + ': ' + errorText.substring(0, 100));
                }
                
                const data = await response.json();
                return { text: data.text || '', language: data.language || 'en' };
                
            } catch (e) {
                debugLog('Groq transcription error: ' + e.message, 'error');
                return null;
            }
        }
        
        async function translateWithGhanaNLP(text, fromLang) {
            if (!state.settings.ghanaNlpKey) {
                debugLog('GhanaNLP key not configured', 'warning');
                return null;
            }
            
            try {
                const langPair = fromLang + '-en';
                const response = await fetch(CONFIG.GHANANLP_TRANSLATE_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Cache-Control': 'no-cache',
                        'Ocp-Apim-Subscription-Key': state.settings.ghanaNlpKey
                    },
                    body: JSON.stringify({ in: text, lang: langPair })
                });
                
                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error('GhanaNLP API ' + response.status + ': ' + errorText.substring(0, 100));
                }
                
                const result = await response.text();
                return result.trim();
                
            } catch (e) {
                debugLog('GhanaNLP translation error: ' + e.message, 'error');
                return null;
            }
        }
        
        function analyzeThreat(translatedText, originalText) {
            const combinedText = (translatedText + ' ' + originalText).toLowerCase();
            
            for (const code of CONFIG.DURESS_CODES) {
                if (combinedText.includes(code.toLowerCase())) {
                    debugLog('üö® DURESS CODE DETECTED: "' + code + '"', 'error');
                    return { level: 'critical', category: 'DURESS CODE ACTIVATED', pattern: code, confidence: 100 };
                }
            }
            
            const levels = ['critical', 'high', 'medium', 'low'];
            for (const level of levels) {
                const patterns = THREAT_PATTERNS[level];
                for (const { pattern, category, weight } of patterns) {
                    const match = combinedText.match(pattern);
                    if (match) {
                        const confidence = Math.min(weight + Math.floor(Math.random() * 10), 100);
                        debugLog('‚ö†Ô∏è Threat detected [' + level.toUpperCase() + ']: ' + category + ' - "' + match[0] + '"', level === 'critical' || level === 'high' ? 'error' : 'warning');
                        return { level, category, pattern: match[0], confidence };
                    }
                }
            }
            
            return null;
        }
        
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        function addTranscriptEntry(original, translation, lang, threat) {
            if (DOM.emptyState && DOM.emptyState.parentNode) {
                DOM.emptyState.parentNode.removeChild(DOM.emptyState);
            }
            
            const entry = document.createElement('div');
            entry.className = 'entry' + (threat ? ' threat-' + threat.level : '');
            
            const time = new Date().toLocaleTimeString();
            const langInfo = CONFIG.LANGUAGES[lang] || { name: lang, flag: 'üåç' };
            
            let html = '<div class="entry-header">' +
                '<span class="entry-time">' + time + '</span>' +
                '<span class="entry-lang"><span class="entry-lang-flag">' + langInfo.flag + '</span>' + langInfo.name + '</span>' +
                '<span class="entry-source">GROQ</span>' +
                (threat ? '<span class="entry-badge ' + threat.level + '">' + threat.level + '</span>' : '') +
                '</div><div class="entry-body">';
            
            if (original !== translation && lang !== 'en') {
                html += '<div class="entry-original">' + escapeHtml(original) + '</div>';
            }
            
            html += '<div class="entry-translation">' + escapeHtml(translation) + '</div></div>';
            
            if (threat) {
                html += '<div class="entry-footer"><div class="entry-threat">' +
                    '<div class="entry-threat-header"><span class="entry-threat-category">' + threat.category + '</span>' +
                    '<span class="entry-threat-confidence">' + threat.confidence + '% confidence</span></div>' +
                    '<div class="entry-threat-pattern">Match: "' + escapeHtml(threat.pattern) + '"</div></div></div>';
            }
            
            entry.innerHTML = html;
            DOM.transcript.appendChild(entry);
            entry.scrollIntoView({ behavior: 'smooth', block: 'end' });
        }
        
        function triggerAlert(threat, translation, original) {
            debugLog('üö® TRIGGERING ' + threat.level.toUpperCase() + ' ALERT: ' + threat.category, 'error');
            
            if (navigator.vibrate) {
                const pattern = threat.level === 'critical' 
                    ? [200, 100, 200, 100, 200, 100, 200, 100, 200]
                    : [200, 100, 200, 100, 200];
                navigator.vibrate(pattern);
            }
            
            playAlertSound(threat.level);
            
            DOM.alertHeader.className = 'alert-header ' + threat.level;
            DOM.alertLevel.textContent = threat.level.toUpperCase() + ' THREAT';
            DOM.alertCategory.textContent = threat.category;
            DOM.alertTime.textContent = new Date().toLocaleString();
            DOM.alertTranscript.textContent = original || translation;
            DOM.alertConfidence.textContent = threat.confidence + '%';
            DOM.alertPattern.textContent = threat.pattern;
            DOM.alertDevice.textContent = state.settings.deviceName;
            DOM.alertAdminEmail.textContent = state.settings.adminEmail;
            DOM.alertSecurityEmail.textContent = state.settings.securityEmail;
            
            if (state.location) {
                const lat = state.location.lat.toFixed(6);
                const lng = state.location.lng.toFixed(6);
                DOM.alertCoords.textContent = lat + ', ' + lng;
                DOM.alertAddress.textContent = state.address || 'Address not available';
                
                const mapUrl = 'https://www.openstreetmap.org/export/embed.html?bbox=' + 
                    (parseFloat(lng) - 0.005) + ',' + (parseFloat(lat) - 0.005) + ',' + 
                    (parseFloat(lng) + 0.005) + ',' + (parseFloat(lat) + 0.005) + 
                    '&layer=mapnik&marker=' + lat + ',' + lng;
                DOM.alertMap.src = mapUrl;
                
                DOM.btnDirections.onclick = () => {
                    window.open('https://www.google.com/maps/dir/?api=1&destination=' + lat + ',' + lng, '_blank');
                };
            } else {
                DOM.alertCoords.textContent = 'GPS unavailable';
                DOM.alertAddress.textContent = 'Enable location services for coordinates';
                DOM.alertMap.src = '';
            }
            
            DOM.alertOverlay.classList.add('visible');
            speakAlert(threat.level + ' threat detected. ' + threat.category);
        }
        
        function dismissAlert() {
            DOM.alertOverlay.classList.remove('visible');
            debugLog('Alert dismissed');
        }
        
        function escalateAlert() {
            const phone = state.settings.securityPhone;
            if (phone) { window.open('tel:' + phone, '_self'); }
            else { showToast('Security phone not configured', 'warning'); }
        }
        
        function playAlertSound(level) {
            try {
                const ctx = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = ctx.createOscillator();
                const gainNode = ctx.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(ctx.destination);
                
                const frequencies = { critical: 880, high: 660, medium: 440, low: 330 };
                oscillator.frequency.value = frequencies[level] || 440;
                oscillator.type = 'sine';
                gainNode.gain.value = 0.3;
                
                oscillator.start();
                
                setTimeout(() => { gainNode.gain.value = 0; }, 150);
                setTimeout(() => { gainNode.gain.value = 0.3; }, 200);
                setTimeout(() => { gainNode.gain.value = 0; }, 350);
                
                if (level === 'critical' || level === 'high') {
                    setTimeout(() => { gainNode.gain.value = 0.3; }, 400);
                    setTimeout(() => { gainNode.gain.value = 0; }, 550);
                }
                
                setTimeout(() => { oscillator.stop(); ctx.close(); }, 600);
                
            } catch (e) { debugLog('Alert sound error: ' + e.message, 'warning'); }
        }
        
        function speakAlert(text) {
            if ('speechSynthesis' in window) {
                try {
                    speechSynthesis.cancel();
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.rate = 1.1;
                    utterance.pitch = 1.0;
                    utterance.volume = 1.0;
                    speechSynthesis.speak(utterance);
                } catch (e) { debugLog('Speech synthesis error: ' + e.message, 'warning'); }
            }
        }
        
        function syncToFirebase(original, translation, lang, threat) {
            if (!db) { debugLog('Firebase not connected, skipping sync', 'warning'); return; }
            
            try {
                const timestamp = Date.now();
                const data = {
                    original, translation, language: lang,
                    languageName: CONFIG.LANGUAGES[lang]?.name || lang,
                    threat: threat ? { level: threat.level, category: threat.category, pattern: threat.pattern, confidence: threat.confidence } : null,
                    location: state.location ? { lat: state.location.lat, lng: state.location.lng, address: state.address } : null,
                    device: state.settings.deviceName,
                    timestamp, timestampISO: new Date(timestamp).toISOString()
                };
                
                db.ref('transcripts').push(data);
                
                if (threat && (threat.level === 'critical' || threat.level === 'high')) {
                    db.ref('alerts').push({ ...data, acknowledged: false, acknowledgedBy: null, acknowledgedAt: null });
                }
                
                debugLog('Data synced to Firebase', 'success');
            } catch (e) { debugLog('Firebase sync error: ' + e.message, 'error'); }
        }
        
        function startLocationTracking() {
            if (!('geolocation' in navigator)) { debugLog('Geolocation not supported', 'warning'); return; }
            
            navigator.geolocation.watchPosition(
                async (position) => {
                    state.location = { lat: position.coords.latitude, lng: position.coords.longitude, accuracy: position.coords.accuracy };
                    debugLog('Location updated: ' + state.location.lat.toFixed(4) + ', ' + state.location.lng.toFixed(4) + ' (¬±' + Math.round(state.location.accuracy) + 'm)');
                    
                    try {
                        const response = await fetch(
                            'https://nominatim.openstreetmap.org/reverse?lat=' + position.coords.latitude + '&lon=' + position.coords.longitude + '&format=json',
                            { headers: { 'User-Agent': 'OGUN Security System' } }
                        );
                        if (response.ok) {
                            const data = await response.json();
                            state.address = data.display_name || '';
                        }
                    } catch (e) { debugLog('Geocoding error: ' + e.message, 'warning'); }
                },
                (error) => { debugLog('Location error: ' + error.message, 'error'); },
                { enableHighAccuracy: true, timeout: 10000, maximumAge: 30000 }
            );
            
            debugLog('Location tracking started');
        }
        
        function triggerPanic() {
            debugLog('üÜò PANIC BUTTON ACTIVATED', 'error');
            
            if (navigator.vibrate) {
                navigator.vibrate([100, 50, 100, 50, 100, 50, 100, 50, 100, 50, 100]);
            }
            
            const panicThreat = { level: 'critical', category: 'MANUAL PANIC ACTIVATION', pattern: 'Panic Button', confidence: 100 };
            
            addTranscriptEntry('PANIC BUTTON', 'Manual panic alert triggered', 'en', panicThreat);
            triggerAlert(panicThreat, 'Manual panic alert triggered', 'PANIC BUTTON PRESSED');
            syncToFirebase('PANIC BUTTON', 'Manual panic alert triggered', 'en', panicThreat);
        }
        
        function activate() {
            if (!state.settings.groqKey) {
                showToast('Configure Groq API key in Settings first', 'error');
                DOM.settingsModal.classList.add('visible');
                return;
            }
            
            state.active = true;
            
            DOM.statusBadge.className = 'status-badge active';
            DOM.statusText.textContent = 'ACTIVE';
            DOM.btnActivate.classList.add('hidden');
            DOM.activeControls.classList.add('visible');
            
            startAudioCapture();
            startLocationTracking();
            
            showToast('OGUN Activated', 'success');
            debugLog('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê', 'success');
            debugLog('           OGUN V9 ACTIVATED           ', 'success');
            debugLog('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê', 'success');
        }
        
        function deactivate() {
            state.active = false;
            stopAudioCapture();
            
            DOM.statusBadge.className = 'status-badge standby';
            DOM.statusText.textContent = 'STANDBY';
            DOM.btnActivate.classList.remove('hidden');
            DOM.activeControls.classList.remove('visible');
            
            showToast('OGUN Deactivated', 'info');
            debugLog('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');
            debugLog('          OGUN V9 DEACTIVATED          ');
            debugLog('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');
        }
        
        function saveAPIKeys() {
            const groqKey = DOM.inputGroqKey.value.trim();
            const ghanaNlpKey = DOM.inputGhanaNlpKey.value.trim();
            
            if (groqKey) {
                saveToStorage(CONFIG.STORAGE_KEYS.GROQ_KEY, groqKey);
                state.settings.groqKey = groqKey;
            }
            if (ghanaNlpKey) {
                saveToStorage(CONFIG.STORAGE_KEYS.GHANANLP_KEY, ghanaNlpKey);
                state.settings.ghanaNlpKey = ghanaNlpKey;
            }
            
            updateStatusIndicators();
            showToast('API keys saved securely', 'success');
            debugLog('API keys saved to local storage', 'success');
        }
        
        function saveTeamSettings() {
            const adminEmail = DOM.inputAdminEmail.value.trim();
            const securityEmail = DOM.inputSecurityEmail.value.trim();
            const securityPhone = DOM.inputSecurityPhone.value.trim();
            const deviceName = DOM.inputDeviceName.value.trim();
            
            if (adminEmail) { saveToStorage(CONFIG.STORAGE_KEYS.ADMIN_EMAIL, adminEmail); state.settings.adminEmail = adminEmail; }
            if (securityEmail) { saveToStorage(CONFIG.STORAGE_KEYS.SECURITY_EMAIL, securityEmail); state.settings.securityEmail = securityEmail; }
            if (securityPhone) { saveToStorage(CONFIG.STORAGE_KEYS.SECURITY_PHONE, securityPhone); state.settings.securityPhone = securityPhone; }
            if (deviceName) { saveToStorage(CONFIG.STORAGE_KEYS.DEVICE_NAME, deviceName); state.settings.deviceName = deviceName; }
            
            showToast('Team settings saved', 'success');
            debugLog('Team settings saved', 'success');
        }
        
        function initEventListeners() {
            DOM.btnActivate.addEventListener('click', activate);
            DOM.btnDeactivate.addEventListener('click', deactivate);
            DOM.btnPanic.addEventListener('click', triggerPanic);
            
            DOM.btnSettings.addEventListener('click', () => { DOM.settingsModal.classList.add('visible'); });
            DOM.btnCloseSettings.addEventListener('click', () => { DOM.settingsModal.classList.remove('visible'); });
            DOM.settingsModal.addEventListener('click', (e) => { if (e.target === DOM.settingsModal) { DOM.settingsModal.classList.remove('visible'); } });
            
            DOM.btnSaveKeys.addEventListener('click', saveAPIKeys);
            DOM.btnSaveTeam.addEventListener('click', saveTeamSettings);
            
            DOM.btnAlertDismiss.addEventListener('click', dismissAlert);
            DOM.btnAlertEscalate.addEventListener('click', escalateAlert);
            
            DOM.debugToggle.addEventListener('click', () => {
                state.debugMode = !state.debugMode;
                DOM.debugPanel.classList.toggle('visible', state.debugMode);
            });
            
            DOM.debugClear.addEventListener('click', () => {
                DOM.debugContent.innerHTML = '';
                debugLog('Debug console cleared');
            });
            
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    DOM.settingsModal.classList.remove('visible');
                    DOM.alertOverlay.classList.remove('visible');
                }
                if (e.ctrlKey && e.key === 'd') {
                    e.preventDefault();
                    state.debugMode = !state.debugMode;
                    DOM.debugPanel.classList.toggle('visible', state.debugMode);
                }
            });
            
            debugLog('Event listeners initialized');
        }
        
        function init() {
            initDOM();
            
            debugLog('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');
            debugLog('       OGUN V9 GODMODE STARTING        ');
            debugLog('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');
            
            loadSettings();
            initFirebase();
            initEventListeners();
            
            debugLog('OGUN V9 initialization complete', 'success');
            debugLog('Device: ' + state.settings.deviceName);
            debugLog('Groq API: ' + (state.settings.groqKey ? 'Configured' : 'NOT CONFIGURED'));
            debugLog('GhanaNLP API: ' + (state.settings.ghanaNlpKey ? 'Configured' : 'NOT CONFIGURED'));
            
            if (!state.settings.groqKey) {
                setTimeout(() => { showToast('Configure API keys in Settings to begin', 'warning'); }, 1000);
            }
        }
        
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
        
    })();
    </script>
</body>
</html>
